# Time Audit Foundry

## System Architecture
Local Tracking: A Python script logs system activity into a local SQLite database.
- Cloud Storage: Local data is pushed to an AWS S3 bucket as an intermediary.
- Browser Tracking: A Chrome Extension captures web usage and sends it to a cloud endpoint or S3.
- Analysis: Palantir Foundry runs a scheduled ingest to pull data from S3 for visualization.

## Implementation Steps
1. Data Capture
#### Web (What applications are being used)
Script: Python monitors active windows or keystrokes.
Storage: Data is saved to activity.db via SQLite.
Sync: A cron job runs a script to upload the .db or .csv file to S3 using boto3.

#### Browser (Google Chrome, via Extension)
Capture: background.js tracks URL changes and time spent.
Export: Data is POSTed to an API or directly to an S3 bucket (using a signed URL).

2. Foundry Integration
After both data sources are each connected to a foundry database (2) a pipeline will do a UNION and normalize the schemas, as well as add a helper column for source. A new column will also be added for time used. 

This will write to an ontology with a singular object type session, with the backing dataset being the UNION. 

Action Types: 
 - Categorize session (the associated domain becomes linked to the category, else AIP default)
 - Categorize if category was productive

3. The final product will be a workshop with the following: 
        * Time of daya allocation breakdown 
        * Day of week allocation 
        * Total Allocation 
        * Top Domains/Groups (based off categorization)
        * Top Shrinkage 
        * Allow Reclassifying (Action Type button group)

## Data Architecture 
<table border="0">
 <tr>
    <td><b style="font-size:30px">Chrome Extension</b></td>
    <td><b style="font-size:30px">Web Script (Python)</b></td>
 </tr>
 <tr>
    <td>
<pre><code>Chrome Extension
        ↓
API Gateway
        ↓
Lambda
        ↓
Foundry Stream Ingest API
        ↓
Stream-backed Dataset
        ↓
Streaming Pipeline</code></pre>
    </td>
    <td>Lorem ipsum ...</td>
 </tr>
</table>


# Broswser Ingest
Chrome extention -> API Gateway -> Lambda -> Foundry Endpoint -> Dataset -> Ontology -> Workshop

### Schema (Before Pipeline)

```sql
event_id        STRING      (not nullable)
user_id         STRING      (not nullable)
domain          STRING      (not nullable)
start_ts        TIMESTAMP   (not nullable)
end_ts          TIMESTAMP   (not nullable)
duration_ms     LONG        (not nullable)
reason_closed   STRING      (not nullable)
schema_version  INTEGER     (not nullable)
```
#### Pipeline added fields: source (web/browser), valuable (was this prodcutive?), category (AIP)